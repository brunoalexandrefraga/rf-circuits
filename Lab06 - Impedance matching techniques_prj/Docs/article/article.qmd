---
title: Prática de Adaptação de Impedância 
subtitle: Laboratório 06
author:
  - name: Bruno Alexandre Fraga
    email: bruno.fraga@posgrad.ufsc.br
    affiliations: 
        - id: some-tech
          name: Universidade Federal de Santa Catarina
          department: Departamento de Engenharia Elétrica e Eletrônica
          address: R. Delfino Conti
          city: Florianópolis
          state: Santa Catarina
          postal-code: 88040-370
abstract: |
  Este trabalho tem por objetivo consolidar a técnica de projeto de redes de casamento de impedância, em especial a técnica pela rede L. Para isso, é proposto realizar o casamento de impedância da saída de um amplificador para uma carga de 50 $\Omega$ de modo que a eficiência da potência dissipada na carga seja de 80%. Após algumas análises o projeto foi concluído com sucesso e realizada uma simulação Monte Carlo com 100 iterações para verificar a robustez do projeto por técnicas estatísticas. Os resultados obtidos foram brevemente discutidos.
keywords: 
  - Robustez
  - Adaptação de impedância
  - Análise estatística
date: last-modified
bibliography: bibliography.bib
format:
  elsevier-pdf:
    include-in-header:
      - text: |
          \usepackage{steinmetz}
          \usepackage[a4paper, margin=1in]{geometry}
          \usepackage{graphicx} % Required for inserting images
          \usepackage{circuitikz}
          \usepackage{amsmath}
          \usepackage{amssymb}
          \usepackage{amsthm}

          \newcommand{\parallelsum}{\mathbin{\!/\mkern-5mu/\!}}
    keep-tex: true
    journal:
      name: RF Circuits
      formatting: preprint
      # model: 3p # Don't set a model with preprint
      cite-style: number
---

# Desenvolvimento
## Admitância ideal

O circuito original é apresentado na Fig.\ref{fig:original-circuit}.

```{=latex}
\begin{figure}[h]
  \centering
    \begin{circuitikz}[american]
      \draw (1.5, 0.5) coordinate(point1) to[R, l=$G_s$] ++(0, -4.5) coordinate(point2) node[ground]{} to[short] ++(-2.5, 0) to[isource, l=$I_s$] ++(0, 4.5) to[short] (point1) to[short, -*] ++(2, 0) coordinate(point3) to[L, l=$B_s$, a=$L$, *-] ++(0, -4.5) coordinate(point4) to[short] (point2) ;
      \draw (point3) to[short, *-] ++(2.5, 0) to[generic, l=$Y_L$, i>^=$I_L$] ++(0, -4.5) to[short] (point4) ;

      % Add the marker for V_{L}
      \node at (point3) [above right] [above] {$V_{L}$};
    \end{circuitikz}
  \caption{Circuito original}
  \label{fig:original-circuit}
\end{figure}
```

Parte-se da restrição principal em que a carga $Y_L$ dissipa uma certa potência com uma eficiência de 80%. Dessa forma, calcula-se

$$
  \eta=\frac{P_L}{P_s}
$$

Em que a potência dissipada na carga, $P_L$, é dada pela seguinte expressão

$$
  P_L=\frac{1}{2}\mathfrak{R}\left\{V_LI_L^*\right\}
$$

sendo $V_L$ a tensão na carga e $I_L^*$ o conjugado da corrente que passa pela mesma.

$$
  I_L=\frac{I_sY_L}{Y_s+Y_L}
$$

e, que $Y_s=G_s+jB_s$, sendo $G_s=1/R_s$ e $B_s=-1/(\omega L)$

$$
  V_L=\frac{I_s}{Y_s+Y_L}
$$

Calculadndo $P_L$, obtém-se

$$
  \begin{split}
    P_L=\frac{1}{2}\frac{|I_s|^2}{|Y_s+Y_L|^2}\mathfrak{R}\left\{Y_L^*\right\}
  \end{split}
$$ {#eq-power-load}


A variável $P_s$, por sua vez é dada por

$$
  \begin{split}
    P_s&=\frac{1}{2}\mathfrak{R}\left\{V_LI_s^*\right\}\implies\\
    &=\frac{|I_s|^2}{2\mathfrak{R}\left\{(Y_s+Y_L)\right\}}\implies\\
    &=\frac{|I_s|^2\mathfrak{R}\left\{(Y_s+Y_L)^*\right\}}{2\mathfrak{R}\left\{(Y_s+Y_L)\right\}\mathfrak{R}\left\{(Y_s+Y_L)^*\right\}}\implies\\
    &=\frac{|I_s|^2\mathfrak{R}\left\{(Y_s+Y_L)^*\right\}}{2|Y_s+Y_L|^2}
  \end{split}
$$

Assim, o cálculo da eficiência é realizado da seguinte forma

$$
  \begin{split}
    \eta&=\frac{|I_s|^2\mathfrak{R}\left\{Y_L^*\right\}}{2|Y_s+Y_L|^2}\cdot\frac{2|Y_s+Y_L|^2}{|I_s|^2\mathfrak{R}\left\{(Y_s+Y_L)^*\right\}}\implies\\
    &=\frac{\mathfrak{R}\left\{Y_L^*\right\}}{\mathfrak{R}\left\{(Y_s+Y_L)^*\right\}}\implies\\
    &=\frac{\mathfrak{R}\left\{(G_L+jB_L)^*\right\}}{\mathfrak{R}\left\{(G_s+jB_s+G_L+jB_L)^*\right\}}\implies\\
    &=\frac{\mathfrak{R}\left\{(G_L+jB_L)^*\right\}}{\mathfrak{R}\left\{[G_s+G_L+j(B_s+B_L)]^*\right\}}\implies\\
    &=\frac{\mathfrak{R}\left\{G_L-jB_L\right\}}{\mathfrak{R}\left\{G_s+G_L-j(B_s+B_L)\right\}}\implies\\
    &=\frac{G_L}{G_s+G_L}
  \end{split}
$$

Dessa forma, deseja-se obter uma equação para $Y_L$.

$$
  \begin{split}
    G_L&=(G_s+G_L)\eta\implies\\
    G_L-\eta G_L&=\eta G_s\implies\\
    G_L(1-\eta)&=\eta G_s\implies\\
    G_L&=G_s\frac{\eta}{1-\eta}
  \end{split}
$$

Para uma eficiência de 80%, a relação anterior resulta em $G_L=4G_s$. A seguir, busca-se determinar a parte imaginária da admitância de carga, ou seja, determinar $B_L$. O problema em questão exige que o amplificador transfira a máxima potência possível com uma eficiência de 80%. Essa máxima potência possível traduz-se em realizar uma análise de forma a maximizar a potência fornecida pelo amplificador, $P_s$. Relembrando a equação,

$$
  \begin{split}
    P_s&=\frac{|I_s|^2\mathfrak{R}\left\{(Y_s+Y_L)^*\right\}}{2|Y_s+Y_L|^2}\implies\\
    &=\frac{|I_s|^2(G_s+G_L)}{2(G_s+G_L)^2+2(B_L+B_s)^2}
  \end{split}
$$

A seguir, demonstra-se matematicamente como que a função $P_s$ pode ser minimizada em função de $B_L$.

$$
    \frac{\partial P_s}{\partial B_L}=0\implies
$$
$$
    \frac{\partial}{\partial B_L}\left[\frac{|I_s|^2(G_s+G_L)}{2(G_s+G_L)^2+2(B_L+B_s)^2}\right]=0
$$

Como o valor de $I_s$ já é conhecido, pode-se remover o símbolo de módulo. Além disso, uma forma simples de se calcular essa derivada é utilizando a regra do quosciente, ou seja,

$$
  \frac{\partial}{\partial B_L}\left[\frac{f(B_L)}{g(B_L)}\right]=\frac{f'(B_L)g(B_L)-f(B_L)g'(B_L)}{[g(B_L)]^2}
$$

em que $f(B_L)=I_s^2(G_s + G_L)$ e $g(B_L)=2(G_s+G_L)^2+2(B_L+B_s)^2$.

Como $f(B_L)$ não depende de $B_L$, $f'(B_L)=0$. E a derivada de $g(B_L)$ é dada por

$$
  \begin{split}
    g'(B_L)&=\left[2(B_L+B_s)^2\right]^{'}\implies\\
    &=2(B_L^2+2B_LB_s+B_s^2)^{'}\implies\\
    &=4(B_L+B_s)\implies\\
  \end{split}
$$

Calculando a derivada completa, obtém-se

$$
  \begin{split}
    \frac{\partial P_s}{\partial B_L}&=\frac{-I_s^2(G_s + G_L)4(B_L+B_s)}{[4(B_L+B_s)]^2}=0\implies\\
    B_L&=-B_s=\frac{1}{\omega L}
  \end{split}
$$

Finalmente, é possível calcular um valor de admitância de carga,

$$
  \begin{split}
    Y_L&=G_L+jB_L\implies\\
    &=G_s\frac{\eta}{1-\eta}+j\frac{1}{\omega L}\implies\\
  \end{split}
$$

```{python}
#| echo: false
import numpy as np
# Definição das constantes
eta = 0.80 # Eficiência
Rs = 65 # Resistência de fonte
Gs = 1 / Rs # Condutância
L = 10e-9 # Indutância em Henry
f = 2.4e9 # Frequência em Hz
omega = 2 * np.pi * f # Frequência angular
RL = 50 # Resistência de carga
Bs = -1 / (omega*L) # Condutância
```

```{python}
#| echo: false
def format(value):
    if value >= 1e9:
        return f"{value / 1e9:.1f} G"
    elif value >= 1e6:
        return f"{value / 1e6:.0f} M"
    elif value >= 1e3:
        return f"{value / 1e3:.0f} k"
    elif value >= 1:
        return f"{value:.0f} "
    elif value >= 1e-3:
        return f"{value * 1e3:.2f} m"
    elif value >= 1e-6:
        return f"{value * 1e6:.0f} μ"
    elif value >= 1e-9:
        return f"{value * 1e9:.0f} n"
    elif value >= 1e-12:
        return f"{value * 1e12:.0f} p"
    else:
        return f"{value:.0e} "
```

Aplicando os valores $\eta =$ `{python} eta*100`%, $G_s = 1/R_s$, $R_s =$ `{python} format(Rs)`$\Omega$, $L =$ `{python} format(L)`H e $\omega=2\pi f$, em que $f =$ `{python} format(f)`Hz.

```{python}
#| echo: false
# Função que calcula G_s * (eta / (1 - eta))
def load_admittance(Gs, eta):
    return Gs * (eta / (1 - eta))

# Função que calcula 1 / (omega * L)
def load_susceptance(omega, L):
    return 1 / (omega * L)
```

```{python}
#| echo: false
GL = load_admittance(Gs, eta)
admittance_value = GL * 1000  # Multiplica por 1000 para converter para mS
formatted_admittance = f"{admittance_value:.2f}"    # Formata para 2 casas decimais

BL = load_susceptance(omega, L)
susceptance_value = BL * 1000  # Multiplica por 1000 para converter para mS
formatted_susceptance = f"{susceptance_value:.2f}"    # Formata para 2 casas decimais
```

$$
  \begin{split}
    Y_L&=\frac{1}{65}\cdot\frac{0,8}{1-0,8}+j\frac{1}{2\cdot \pi\cdot 2,4\cdot 10^9\cdot 10\cdot 10^{-9}}\implies\\
    &=\frac{4}{65}+j\frac{1}{48\pi}
  \end{split}
$$


```{python}
#| echo: false
# Função que calcula G_s * (eta / (1 - eta))
def load_resistence(GL, BL):
    RL = GL/(GL**2 + BL**2)
    return RL

# Função que calcula 1 / (omega * L)
def load_reactance(GL, BL):
    BL = BL/(GL**2 + BL**2)
    return BL
```

```{python}
#| echo: false
def format_2_decimals(value):
    return f"{value:.2f}"
```

Finalmente, obtém-se o valor $Y_L =$ `{python} formatted_admittance` + j`{python} formatted_susceptance` mS. Semelhantemente, obtém-se uma impedância de carga, $Z_L =$ `{python} format_2_decimals(load_resistence(GL, BL))` - j`{python} format_2_decimals(load_reactance(GL, BL))` $\Omega$. Assim, obtém-se que para que para que a carga dissipe potência com uma eficiência, $\eta$ de `{python} eta*100`%, esta deve ter como parte real da sua admitância, $G_L =$ `{python} formatted_admittance` mS. Além disso, foi demonstrado que, para que o amplificador forneça a máxima potência possível, essa carga deve ter uma parte imaginária de admitância, $B_L$, igual a `{python} formatted_susceptance` mS.

A seguir, são apresentadas as verificações no simulador QucsStudio. Para realizar as devidas verificações, toma-se como base o circuito da [Fig. @fig-circuit-qucs-original]. Em essência, o circuito apresentado é o mesmo fornecido com o problema, com a inclusão de um monopolo que serve como uma carga aterrada (esse bloco foi selecionado, pois permite informar uma admitância).

![Circuito para verificação da admitância obtida](../images/Qucs-circuit-reference.png){width=300, #fig-circuit-qucs-original}

Na [Fig. @fig-y-real-validation] é possível verificar que se a curva da da eficiência de potência na carga for traçada em função da parte real da admitância de carga, $G_L$, o valor que atinge `{python} eta*100`% é exatamente o que foi obtido anteriormente.

![Validação da parte real da admitância (condutância) de carga](../images/GLxEta_validation.png){width=300, #fig-y-real-validation}

Além disso, a [Fig. @fig-y-imaginary-validation] demonstra que a eficiência de potência na carga não varia em nada com a susceptância da carga, conforme previsto.

![Validação da parte imaginária da admitância (susceptância) de carga](../images/BLxEta_validation.png){width=300, #fig-y-imaginary-validation}

Outra validação que é necessária é em relação ao valor da susceptância de carga, $B_L$. Nesse caso, a restrição diz que, dada a eficiência de `{python} eta*100`%, a amplificador deve transmitir a maior potência possível à carga. Além de validar a susceptância da carga, também pode ser realizada a validação da potência dissipada pela carga. Para isso, é realizada a adaptação da [Eq. @eq-power-load] para aplicar os valores obtidos anteriormente.

$$
  P_L=\frac{I_s^2G_L}{2(G_s + G_L)^2 + 2(B_s + B_L)^2}
$$ {#eq-power-load-formatted}

Como a restrição para a máxima transferência de energia (possível para a eficiência desejada) impõe que $B_s=-B_L$, a [Eq. @eq-power-load-formatted] pode ser escrita como

$$
  P_L=\frac{I_s^2G_L}{2(G_s + G_L)^2}
$$ {#eq-power-load-finished}

```{python}
#| echo: false
Is = 100e-3
def calculate_power_load():
  return (Is**2*GL)/(2*(Gs+GL)**2)
```

Aplicando os valores à equação [Eq. @eq-power-load-finished] obtém-se uma potência $P_L =$ `{python} format(calculate_power_load())`W. Todos esses valores que foram previstos matematicamente podem ser visualizados na [Fig. @fig-y-imaginary-validation], em que é apresentado o gráfico da potência na carga pela susceptância da carga. Além disso, a função `max` do QucsStudio foi utilizada para obter o ponto máximo da função da potência pela susceptância e a função `xvalue` é utilizada para obter o valor de $B_L$ correspondente para essa potência.

![Validação da parte imaginária da admitância (susceptância) de carga](../images/PLxBL_validation.png){width=300, #fig-y-imaginary-validation}

## Rede de adaptação 

Tendo a admitância calculada (e consequentemete a impedância), é possível realizar o cálculo da rede de adaptação. Aqui, deseja-se que o circuito equivalente do amplificador visualize a impedância obtida, sendo que a impedância de carga própriamente dita é de `{python} RL` $\Omega$. Dessa forma, deseja-se adaptar uma resistência de `{python} RL` $\Omega$ em `{python} format_2_decimals(load_resistence(GL, BL))` $\Omega$. Para os cálculos apresentados a seguir, considera-se $R_i$ como a impedância a ser adaptada e $R_o$ a impedância desejada. A Fig.\ref{fig:matching-network} apresenta o circuito com a rede de adaptação na topologia que será utilizada. Para essa rede de adaptação, buscou-se a topologia com o capacitor em série e o indutor em paralelo, uma vez que é desejado que o sinal de alta frequência seja tranferido à carga, enquanto bloqueia sinais de baixas frequências. Outra característica da topologia é que trata-se de uma rede L paralelo-série. Essa topologia é necessária, uma vez que deseja-se diminuir $R_i$ para se adaptar à resistência $R_o$ (equivalentemente, deseja-se elevar $R_o$ em relação a $R_i$).

```{=latex}
\begin{figure}[h]
  \centering
    \begin{circuitikz}[american]
      \draw (-1, 0) coordinate(point1) to[R, l=$R_i$] (-1, -3) node[ground]{} ;
      \draw (point1) to[short] (1.5, 0) coordinate(point2) to[L, l=L, a=$X_L$] (1.5, -3) node[ground]{} ;
      \draw (4, -3) coordinate(point3) node[ground]{} ;
      \draw (4, 0) coordinate(point4) to[R, l=$R_o$] (point3) ;
      \draw (point2) to[C, l=C, a=$X_C$] (point4) ;

      \draw (2, -3.5) -- ++(0, 1) to[short] ++(0.05, 0) to[short, i=$Z_i$] ++(0.2,0) ;
    \end{circuitikz}
  \caption{Rede de adaptação}
  \label{fig:matching-network}
\end{figure}
```

















# References {-}
